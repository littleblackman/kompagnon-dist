import{c as r,o,a as e,r as q,F as N,k as V,b as P,y as R,h as c,e as O,f as z,A as F,i as M,m as B,t as D,D as ne,v as J,d as Z,E as xe,C as A,G as ae,l as be,T as he,g as ie,B as ye,H as we,I as _e,u as ke,x as $e}from"./DDbqB2VL.js";import{a as K,u as W}from"./BTMoKPNP.js";import{_ as de}from"./DKTG0W-z.js";import{P as Ce}from"./DqQgUgxU.js";import{_ as X}from"./DlAUqK2U.js";import{useMetadataStore as Se}from"./Buzi5y1C.js";import{r as je,a as Ie,P as qe}from"./BlRu_04W.js";import{t as Pe}from"./BzhHMnxU.js";import{r as Me}from"./BcP2C12F.js";import{r as De}from"./BeOHE0yY.js";import"./DKoE4HND.js";import"./BqMwdbGL.js";function ue(C,n){return o(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19.5 13.5 12 21m0 0-7.5-7.5M12 21V3"})])}function ce(C,n){return o(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4.5 10.5 12 3m0 0 7.5 7.5M12 3v18"})])}function Ee(C,n){return o(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m4.5 5.25 7.5 7.5 7.5-7.5m-15 6 7.5 7.5 7.5-7.5"})])}function Le(C,n){return o(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m4.5 18.75 7.5-7.5 7.5 7.5"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m4.5 12.75 7.5-7.5 7.5 7.5"})])}function Ae(C,n){return o(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m19.5 8.25-7.5 7.5-7.5-7.5"})])}function Te(C,n){return o(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m8.25 4.5 7.5 7.5-7.5 7.5"})])}function Ne(C,n){return o(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"})])}function ve(C,n){return o(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L6.832 19.82a4.5 4.5 0 0 1-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 0 1 1.13-1.897L16.863 4.487Zm0 0L19.5 7.125"})])}function oe(C,n){return o(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4.5v15m7.5-7.5h-15"})])}function Ve(C,n){return o(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"})])}function ze(C,n){return o(),r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"fill-rule":"evenodd",d:"M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12Zm8.706-1.442c1.146-.573 2.437.463 2.126 1.706l-.709 2.836.042-.02a.75.75 0 0 1 .67 1.34l-.04.022c-1.147.573-2.438-.463-2.127-1.706l.71-2.836-.042.02a.75.75 0 1 1-.671-1.34l.041-.022ZM12 9a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z","clip-rule":"evenodd"})])}function Be(C,n){return o(),r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"fill-rule":"evenodd",d:"M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.006 5.404.434c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.434 2.082-5.005Z","clip-rule":"evenodd"})])}const Oe={class:"flex items-center whitespace-nowrap"},Ue=["onClick","onMouseover"],He={__name:"RatingStars",props:{rating:Number,sequenceId:Number,criteriaId:Number},emits:["rate"],setup(C,{emit:n}){const u=q(0),p=l=>{},a=l=>{};return(l,t)=>(o(),r("div",Oe,[(o(),r(N,null,V(10,s=>e("span",{key:s,class:"cursor-default",onClick:v=>a(),onMouseover:v=>p(),onMouseleave:t[0]||(t[0]=v=>u.value=0)},[P(c(Be),{class:R(["w-5 h-5 transition-colors",s<=(u.value||C.rating)?"text-yellow-500":"text-gray-200"])},null,8,["class"])],40,Ue)),64))]))}},Re={class:"fixed inset-0 flex items-center justify-center z-50"},Fe={class:"bg-white rounded p-6 w-[800px] border-2 border-amber-950 shadow-xl"},Ze={class:"text-xl font-bold mb-4"},Ke={class:"mb-4"},Je=["value"],Ge={key:0,class:"mb-4"},Qe=["disabled"],We=["value"],Xe={class:"flex justify-between mt-4"},Ye={class:"space-x-4"},et={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60]"},pe=O({__name:"SequenceModal",props:{sequence:Object,projectId:Number},emits:["close","save","delete"],setup(C,{emit:n}){const u=K(),p=C,a=n,l=q({...p.sequence}),t=q(null),s=q(null),v=q(!1),j=z(()=>u.parts),x=z(()=>{if(!t.value)return[];const m=u.parts.find(_=>_.id===t.value);return(m==null?void 0:m.sequences)||[]});F(()=>p.sequence,m=>{m?(l.value={...m},t.value=m.part_id,s.value=null):(l.value={name:"",description:""},t.value=null,s.value=null)},{immediate:!0}),F(t,()=>{s.value=null});const f=async()=>{if(!t.value){alert("Veuillez sÃ©lectionner une partie");return}if(!l.value.name.trim()){alert("Le nom est obligatoire");return}const m={...l.value,part_id:t.value};try{if(l.value.id)await u.updateSequenceContent(m),a("close");else{a("save",{sequence:m,afterSequenceId:s.value});return}}catch(_){console.error("Erreur lors de la sauvegarde:",_),alert("Erreur lors de la sauvegarde")}},i=()=>{v.value=!0},b=()=>{a("delete",l.value),v.value=!1},$=()=>{v.value=!1};return(m,_)=>(o(),r("div",Re,[e("div",Fe,[e("h3",Ze,D(l.value.id?"Modifier la sÃ©quence":"Ajouter une sÃ©quence"),1),e("div",Ke,[_[6]||(_[6]=e("label",{class:"block mb-2 font-semibold"},"Partie associÃ©e :",-1)),B(e("select",{"onUpdate:modelValue":_[0]||(_[0]=w=>t.value=w),class:"border rounded p-2 w-full"},[_[5]||(_[5]=e("option",{value:null},"SÃ©lectionner une partie",-1)),(o(!0),r(N,null,V(j.value,w=>(o(),r("option",{key:w.id,value:w.id},D(w.name),9,Je))),128))],512),[[ne,t.value]])]),l.value.id?M("",!0):(o(),r("div",Ge,[_[8]||(_[8]=e("label",{class:"block mb-2 font-semibold"},"InsÃ©rer aprÃ¨s :",-1)),B(e("select",{"onUpdate:modelValue":_[1]||(_[1]=w=>s.value=w),class:"border rounded p-2 w-full",disabled:!t.value},[_[7]||(_[7]=e("option",{value:null},"DÃ©but de la partie",-1)),(o(!0),r(N,null,V(x.value,w=>(o(),r("option",{key:w.id,value:w.id},D(w.name),9,We))),128))],8,Qe),[[ne,s.value]])])),_[9]||(_[9]=e("label",{class:"block mb-2 font-semibold"},"Nom :",-1)),B(e("input",{type:"text","onUpdate:modelValue":_[2]||(_[2]=w=>l.value.name=w),class:"border rounded p-2 w-full mb-4"},null,512),[[J,l.value.name]]),_[10]||(_[10]=e("label",{class:"block mb-2 font-semibold"},"Description :",-1)),P(de,{modelValue:l.value.description,"onUpdate:modelValue":_[3]||(_[3]=w=>l.value.description=w),"content-type":"organizational"},null,8,["modelValue"]),e("div",Xe,[e("div",null,[l.value.id?(o(),r("button",{key:0,onClick:i,class:"px-4 py-2 bg-red-500 text-white rounded"}," Supprimer ")):M("",!0)]),e("div",Ye,[e("button",{onClick:_[4]||(_[4]=w=>a("close")),class:"px-4 py-2 bg-gray-500 text-white rounded"},"Annuler"),e("button",{onClick:f,class:"px-4 py-2 bg-primary text-white rounded"}," Valider ")])])]),v.value?(o(),r("div",et,[e("div",{class:"bg-white rounded-lg p-6 max-w-sm w-full mx-4 shadow-xl"},[_[11]||(_[11]=e("h3",{class:"text-lg font-bold mb-4"},"Confirmation de suppression",-1)),_[12]||(_[12]=e("p",{class:"text-gray-600 mb-6"},"ÃŠtes-vous sÃ»r de vouloir supprimer cette sÃ©quence ?",-1)),e("div",{class:"flex justify-end space-x-4"},[e("button",{onClick:$,class:"px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300 transition-colors"}," Annuler "),e("button",{onClick:b,class:"px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 transition-colors"}," Supprimer ")])])])):M("",!0)]))}}),tt={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},nt={class:"bg-white rounded-lg max-w-2xl w-full mx-4 shadow-xl"},ot={class:"p-8"},st={class:"space-y-4 mb-8"},rt={class:"flex-1"},lt={class:"font-medium text-gray-900"},at={class:"text-sm text-gray-500"},it={class:"text-green-600"},dt=["onClick"],ut={class:"flex justify-end space-x-3"},me=O({__name:"PersonnageDetectionModal",setup(C){const n=W(),u=K(),p=z(()=>{if(!n.currentSequenceId||!u.project)return n.detectedCharacters;let t=null;for(const v of u.project.parts)if(v.sequences&&(t=v.sequences.find(j=>j.id===n.currentSequenceId),t))break;if(!t||!t.sequencePersonnages)return n.detectedCharacters;const s=t.sequencePersonnages.map(v=>{var j;return(j=v.personnage)==null?void 0:j.id}).filter(Boolean);return n.detectedCharacters.filter(v=>{var j;return!s.includes((j=v.personnage)==null?void 0:j.id)})});F(p,t=>{n.showDetectionModal&&t.length===0&&(console.log("No characters to suggest, closing modal"),n.closeDetectionModal())},{immediate:!0});const a=async t=>{var v;if(!n.currentSequenceId)return;await n.addPersonnageToSequence(t,n.currentSequenceId)&&((v=u.project)!=null&&v.slug&&await u.fetchProject(u.project.slug),n.detectedCharacters=n.detectedCharacters.filter(j=>{var x;return((x=j.personnage)==null?void 0:x.id)!==t}),n.detectedCharacters.length===0&&n.closeDetectionModal())},l=async()=>{var t;for(const s of p.value)s.personnage&&n.currentSequenceId&&await n.addPersonnageToSequence(s.personnage.id,n.currentSequenceId);(t=u.project)!=null&&t.slug&&await u.fetchProject(u.project.slug),n.closeDetectionModal()};return(t,s)=>c(n).showDetectionModal?(o(),r("div",tt,[e("div",nt,[e("div",ot,[s[1]||(s[1]=e("h3",{class:"text-lg font-bold mb-4 text-gray-900"},"Personnages dÃ©tectÃ©s",-1)),s[2]||(s[2]=e("p",{class:"text-gray-600 mb-4"}," Des personnages ont Ã©tÃ© dÃ©tectÃ©s dans le contenu de cette scÃ¨ne. Voulez-vous les ajouter Ã  la sÃ©quence ? ",-1)),e("div",st,[(o(!0),r(N,null,V(p.value,v=>{var j;return o(),r("div",{key:`${(j=v.personnage)==null?void 0:j.id}-${v.name}`,class:"flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors"},[e("div",rt,[e("div",lt,D(c(n).getPersonnageName(v.personnage)),1),e("div",at,[Z(' TrouvÃ© : "'+D(v.name)+'" ',1),e("span",it,"("+D(Math.round(v.confidence*100))+"% de correspondance)",1)])]),e("button",{onClick:x=>a(v.personnage.id),class:"px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700 transition-colors"}," Ajouter ",8,dt)])}),128))]),e("div",ut,[e("button",{onClick:s[0]||(s[0]=v=>c(n).closeDetectionModal()),class:"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors"}," Ignorer "),e("button",{onClick:l,class:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition-colors"}," Tout ajouter ")])])])])):M("",!0)}}),ct={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},vt={class:"bg-white rounded-lg max-w-md w-full mx-4 shadow-xl"},pt={class:"p-6"},mt={class:"space-y-4 mb-6"},ft=O({__name:"PersonnageConfigModal",props:{showConfig:{type:Boolean,default:!1},showConfigModifiers:{}},emits:["update:showConfig"],setup(C){const n=W(),u=xe(C,"showConfig"),p=q({maxDistance:n.detectionConfig.maxDistance,minLength:n.detectionConfig.minLength}),a=()=>{n.setDetectionConfig(p.value),u.value=!1},l=()=>{p.value={maxDistance:n.detectionConfig.maxDistance,minLength:n.detectionConfig.minLength},u.value=!1};return(t,s)=>u.value?(o(),r("div",ct,[e("div",vt,[e("div",pt,[s[6]||(s[6]=e("h3",{class:"text-lg font-bold mb-4 text-gray-900"},"Configuration dÃ©tection personnages",-1)),s[7]||(s[7]=e("p",{class:"text-gray-600 mb-4"}," Configurez les paramÃ¨tres pour la dÃ©tection automatique des personnages dans les scÃ¨nes. ",-1)),e("div",mt,[e("div",null,[s[2]||(s[2]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Distance maximum (2-3 caractÃ¨res) ",-1)),B(e("input",{"onUpdate:modelValue":s[0]||(s[0]=v=>p.value.maxDistance=v),type:"number",min:"1",max:"5",class:"w-full border rounded p-2"},null,512),[[J,p.value.maxDistance,void 0,{number:!0}]]),s[3]||(s[3]=e("p",{class:"text-xs text-gray-500 mt-1"}," Plus la distance est Ã©levÃ©e, plus la dÃ©tection sera permissive. ",-1))]),e("div",null,[s[4]||(s[4]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Longueur minimum (3 caractÃ¨res) ",-1)),B(e("input",{"onUpdate:modelValue":s[1]||(s[1]=v=>p.value.minLength=v),type:"number",min:"2",max:"10",class:"w-full border rounded p-2"},null,512),[[J,p.value.minLength,void 0,{number:!0}]]),s[5]||(s[5]=e("p",{class:"text-xs text-gray-500 mt-1"}," Mots plus courts que cette valeur seront ignorÃ©s. ",-1))])]),e("div",{class:"flex justify-end space-x-3"},[e("button",{onClick:l,class:"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors"}," Annuler "),e("button",{onClick:a,class:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors"}," Sauvegarder ")])])])])):M("",!0)}}),gt={key:0,class:"absolute top-full mt-1 left-1/2 -translate-x-1/2 bg-black text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap z-10"},xt={class:"bg-white rounded-2xl shadow-2xl p-8 w-full max-w-2xl mx-4"},bt={class:"flex items-center space-x-3 mb-6"},ht={class:"text-xl font-semibold text-gray-800"},yt=["placeholder"],wt={class:"flex justify-end mt-6 space-x-3"},te=O({__name:"FieldIcon",props:{icon:{},text:{},color:{},onSave:{type:Function},title:{},placeholder:{}},setup(C){const n=C,u=q(!1),p=q(n.text);F(()=>n.text,()=>{p.value=n.text});function a(){n.onSave(p.value),u.value=!1}return(l,t)=>(o(),r("div",{class:"relative group cursor-pointer",onClick:t[3]||(t[3]=s=>u.value=!0)},[(o(),A(ae(l.icon),{class:R(["w-7 h-7 mr-2 transition-transform duration-200 group-hover:scale-110",l.color])},null,8,["class"])),l.text?(o(),r("div",gt,D(l.text),1)):M("",!0),(o(),A(he,{to:"body"},[u.value?(o(),r("div",{key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:t[2]||(t[2]=be(s=>u.value=!1,["self"]))},[e("div",xt,[e("div",bt,[(o(),A(ae(l.icon),{class:R(["w-6 h-6",l.color])},null,8,["class"])),e("h2",ht,D(l.title||"Modifier le contenu"),1)]),B(e("textarea",{"onUpdate:modelValue":t[0]||(t[0]=s=>p.value=s),class:"w-full h-40 border-2 border-gray-200 rounded-xl p-4 text-gray-700 placeholder-gray-400 focus:border-blue-400 focus:ring-2 focus:ring-blue-100 transition-all duration-200 resize-none",placeholder:l.placeholder||"Ã‰crivez votre contenu ici..."},null,8,yt),[[J,p.value]]),e("div",wt,[e("button",{class:"px-6 py-2.5 text-gray-600 hover:text-gray-800 transition-colors duration-200 font-medium",onClick:t[1]||(t[1]=s=>u.value=!1)}," Annuler "),e("button",{class:"px-6 py-2.5 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-xl font-medium transition-all duration-200 shadow-lg hover:shadow-xl",onClick:a}," Enregistrer ")])])])):M("",!0)]))]))}}),_t=window.setInterval,kt={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},$t={class:"bg-white rounded-lg w-[90%] max-w-7xl h-[95vh] flex flex-col"},Ct={class:"p-6 border-b border-gray-200 flex justify-between items-center flex-shrink-0"},St={class:"flex items-center space-x-2"},jt=["disabled"],It={key:0,class:"hidden sm:inline"},qt={class:"flex-1 mx-4"},Pt={class:"flex items-center space-x-2"},Mt=["disabled"],Dt={key:0,class:"hidden sm:inline"},Et={class:"flex items-center space-x-2"},Lt={key:0,class:"text-green-600 text-sm flex items-center"},At={key:1,class:"text-blue-600 text-sm flex items-center"},Tt={key:2,class:"text-orange-600 text-sm flex items-center"},Nt={key:3,class:"text-red-600 text-sm flex items-center"},Vt={class:"p-6 flex-1 overflow-y-auto flex flex-col"},zt={class:"mb-6 flex-shrink-0"},Bt={class:"flex-1 min-h-0"},Ot={class:"h-full"},Ut={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60]"},Ht=O({__name:"SceneModal",props:{scene:{type:Object,required:!0},projectId:{type:Number,required:!0},sequenceId:{type:Number,required:!0},availableScenes:{type:Array,required:!0}},emits:["close","save","delete","navigate"],setup(C,{emit:n}){var H,Q,se,re,le;const u=K(),p=W(),a=C,l=n,t=q(null),s=q(null),v=q(null),j=q(!1),x=q("saved");let f=null;const i=q({id:(H=a.scene)==null?void 0:H.id,name:((Q=a.scene)==null?void 0:Q.name)||"",description:((se=a.scene)==null?void 0:se.description)||"",content:((re=a.scene)==null?void 0:re.content)||"",position:((le=a.scene)==null?void 0:le.position)||0});z(()=>u.sequences);const b=z(()=>{var h;return(h=t.value)!=null&&h.id?a.availableScenes.findIndex(L=>{var T;return L.id===((T=t.value)==null?void 0:T.id)}):-1}),$=z(()=>{const y=b.value;return y>0?a.availableScenes[y-1]:null}),m=z(()=>{const y=b.value;return y>=0&&y<a.availableScenes.length-1?a.availableScenes[y+1]:null});F(()=>a.scene,y=>{if(y){t.value={...y},s.value=y.sequenceId,i.value={id:y.id,name:y.name,description:y.description,content:y.content,position:y.position};const h=a.availableScenes.findIndex(L=>L.id===y.id);h>0?v.value=a.availableScenes[h-1].id:v.value=null}else t.value={id:0,name:"",description:"",content:"",status:[],sequenceId:a.sequenceId||0,position:0},s.value=a.sequenceId||null,v.value=null,i.value={id:0,name:"",description:"",content:"",position:0}},{immediate:!0}),F(()=>t.value,y=>{y&&(i.value={id:y.id,name:y.name,description:y.description,content:y.content,position:y.position})},{deep:!0}),F(s,()=>{v.value=null});const _=async()=>{var y;try{const h=await u.saveScene(i.value,a.sequenceId);h&&(l("save",h),(y=t.value)!=null&&y.content&&(console.log("DÃ©tection personnages pour:",t.value.content.substring(0,100)),console.log("Personnages disponibles:",p.personnages.length),await p.detectAndSuggestCharacters(t.value.content,a.sequenceId)),p.showDetectionModal||l("close"))}catch(h){console.error("Erreur lors de la sauvegarde de la scÃ¨ne:",h)}},w=async()=>{if(i.value.id)try{await u.deleteScene(i.value.id),l("close")}catch(y){console.error("Erreur lors de la suppression de la scÃ¨ne:",y)}},U=async()=>{var y;if(t.value&&i.value.id)try{i.value.name=t.value.name,i.value.description=t.value.description,i.value.content=t.value.content,await u.saveScene(i.value,a.sequenceId),(y=t.value)!=null&&y.content&&(console.log("Auto-save dÃ©tection pour:",t.value.content.substring(0,100)),await p.detectAndSuggestCharacters(t.value.content,a.sequenceId))}catch(h){console.error("Erreur lors de l'auto-save:",h)}},G=async()=>{$.value&&(await U(),l("navigate",$.value))},Y=async()=>{m.value&&(await U(),l("navigate",m.value))},ee=async()=>{var L;await U();const h={name:"Nouvelle scÃ¨ne",description:"",content:"",position:(((L=t.value)==null?void 0:L.position)||0)+1,sequenceId:a.sequenceId,status:[]};try{const T=await u.saveScene(h,a.sequenceId);l("navigate",T)}catch(T){console.error("Erreur lors de la crÃ©ation de la scÃ¨ne:",T)}},S=()=>{var y;if((y=t.value)!=null&&y.id){const h=`scene_draft_${t.value.id}`,L={name:t.value.name,description:t.value.description,content:t.value.content,timestamp:Date.now()};localStorage.setItem(h,JSON.stringify(L)),console.log("ðŸ’¾ Sauvegarde locale effectuÃ©e")}},k=()=>{var y;if((y=t.value)!=null&&y.id){const h=`scene_draft_${t.value.id}`,L=localStorage.getItem(h);if(L)try{const T=JSON.parse(L);Date.now()-T.timestamp<24*60*60*1e3&&(t.value.name=T.name,t.value.description=T.description,t.value.content=T.content,x.value="unsaved",console.log("ðŸ”„ Brouillon rÃ©cupÃ©rÃ© du localStorage"))}catch(T){console.error("Erreur lors du chargement du draft:",T)}}},d=()=>{var y;if((y=t.value)!=null&&y.id){const h=`scene_draft_${t.value.id}`;localStorage.removeItem(h)}};let g=null;const I=()=>{g&&clearTimeout(g),x.value="unsaved",g=setTimeout(async()=>{var y;if((y=t.value)!=null&&y.id)try{x.value="saving",await U(),x.value="saved",d()}catch(h){x.value="error",console.error("Erreur auto-save:",h)}},3e3)};F(()=>t.value,()=>{t.value&&(S(),I())},{deep:!0}),ie(()=>{k(),f=_t(()=>{var h;x.value==="unsaved"&&((h=t.value)!=null&&h.id)&&I()},3e4);const y=h=>{x.value==="unsaved"&&(h.preventDefault(),h.returnValue="Vous avez des modifications non sauvegardÃ©es. Voulez-vous vraiment quitter ?")};window.addEventListener("beforeunload",y)}),ye(()=>{f&&clearInterval(f),g&&clearTimeout(g)});const E=()=>{x.value==="unsaved"?confirm("Vous avez des modifications non sauvegardÃ©es. Voulez-vous vraiment fermer ?")&&(d(),l("close")):(d(),l("close"))};return(y,h)=>(o(),r("div",null,[P(me),t.value?(o(),r("div",kt,[e("div",$t,[e("div",Ct,[e("div",St,[e("button",{onClick:G,disabled:!$.value,class:R(["px-3 py-2 rounded-lg font-medium transition-colors flex items-center gap-2",$.value?"bg-gray-100 hover:bg-gray-200 text-gray-700":"bg-gray-50 text-gray-400 cursor-not-allowed"]),title:"ScÃ¨ne prÃ©cÃ©dente"},[h[3]||(h[3]=Z(" â† ")),$.value?(o(),r("span",It,D($.value.name),1)):M("",!0)],10,jt)]),e("div",qt,[B(e("input",{"onUpdate:modelValue":h[0]||(h[0]=L=>t.value.name=L),type:"text",class:"text-2xl font-bold text-blue-600 w-full bg-transparent border-b border-transparent hover:border-blue-600 focus:border-blue-600 focus:outline-none text-center",placeholder:"Nom de la scÃ¨ne"},null,512),[[J,t.value.name]])]),e("div",Pt,[e("button",{onClick:ee,class:"px-3 py-2 bg-green-100 hover:bg-green-200 text-green-700 rounded-lg font-medium transition-colors",title:"Ajouter une scÃ¨ne aprÃ¨s"}," + ScÃ¨ne "),e("button",{onClick:Y,disabled:!m.value,class:R(["px-3 py-2 rounded-lg font-medium transition-colors flex items-center gap-2",m.value?"bg-gray-100 hover:bg-gray-200 text-gray-700":"bg-gray-50 text-gray-400 cursor-not-allowed"]),title:"ScÃ¨ne suivante"},[m.value?(o(),r("span",Dt,D(m.value.name),1)):M("",!0),h[4]||(h[4]=Z(" â†’ "))],10,Mt),e("div",Et,[x.value==="saved"?(o(),r("span",Lt," âœ… SauvÃ© ")):x.value==="saving"?(o(),r("span",At," â³ Sauvegarde... ")):x.value==="unsaved"?(o(),r("span",Tt," ðŸ’¾ Non sauvÃ© ")):x.value==="error"?(o(),r("span",Nt," âŒ Erreur ")):M("",!0)]),e("button",{onClick:_,class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium"}," Enregistrer "),e("button",{onClick:E,class:"text-gray-500 hover:text-gray-700 p-2"},h[5]||(h[5]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))])]),e("div",Vt,[e("div",zt,[h[6]||(h[6]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Description",-1)),B(e("input",{"onUpdate:modelValue":h[1]||(h[1]=L=>t.value.description=L),type:"text",class:"w-full border rounded p-2"},null,512),[[J,t.value.description]])]),e("div",Bt,[h[7]||(h[7]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Contenu",-1)),e("div",Ot,[P(de,{modelValue:t.value.content,"onUpdate:modelValue":h[2]||(h[2]=L=>t.value.content=L),class:"h-full","content-type":"printable","editor-height":"100%"},null,8,["modelValue"])])])])])])):M("",!0),j.value?(o(),r("div",Ut,[e("div",{class:"bg-white rounded-lg p-6 max-w-sm w-full mx-4 shadow-xl"},[h[8]||(h[8]=e("h3",{class:"text-lg font-bold mb-4"},"Confirmation de suppression",-1)),h[9]||(h[9]=e("p",{class:"text-gray-600 mb-6"},"ÃŠtes-vous sÃ»r de vouloir supprimer cette scÃ¨ne ?",-1)),e("div",{class:"flex justify-end space-x-4"},[e("button",{onClick:w,class:"px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 transition-colors"}," Supprimer ")])])])):M("",!0)]))}}),fe=X(Ht,[["__scopeId","data-v-e5469db6"]]),Rt={key:1},Ft={class:"flex justify-between"},Zt=["id","onClick"],Kt={class:"flex space-x-1"},Jt=["onClick"],Gt=["disabled","onClick"],Qt=["disabled","onClick"],Wt=["onClick"],Xt=["onClick"],Yt=["innerHTML"],en={class:"ml-4 mb-4"},tn={key:2,class:"ml-4"},nn=O({__name:"SceneList",props:{scenes:{type:Array,required:!0},projectId:{type:Number,required:!0},sequenceId:{type:Number,required:!0}},setup(C){const n=K(),u=C,p=z(()=>u.scenes?[...u.scenes].sort((b,$)=>b.position-$.position):[]),a=q(!1),l=q(null),t=q(null),s=(b=null)=>{if(!b)l.value={id:void 0,name:"",description:"",content:"",status:[],sequenceId:u.sequenceId,position:u.scenes.length},u.scenes.length>0?t.value=u.scenes[u.scenes.length-1].id:t.value=null;else{l.value={...b};const $=u.scenes.findIndex(m=>m.id===b.id);$>0?t.value=u.scenes[$-1].id:t.value=null}a.value=!0},v=async b=>{try{await n.saveScene(b,u.sequenceId,t.value),a.value=!1}catch($){console.error("Erreur lors de la sauvegarde :",$)}},j=async b=>{try{await n.deleteScene(b.id)}catch($){console.error("Erreur lors de la suppression :",$)}},x=async(b,$)=>{var _;const m=p.value.findIndex(w=>w.id===b.id);try{if($==="up"&&m>0){const w=[...p.value];[w[m],w[m-1]]=[w[m-1],w[m]],w.forEach((U,G)=>{U.position=G+1}),await n.saveSceneOrder(w)}else if($==="down"&&m<p.value.length-1){const w=[...p.value];[w[m],w[m+1]]=[w[m+1],w[m]],w.forEach((U,G)=>{U.position=G+1}),await n.saveSceneOrder(w)}(_=n.project)!=null&&_.slug&&await n.fetchProject(n.project.slug)}catch(w){console.error("Erreur lors du dÃ©placement de la scÃ¨ne:",w)}},f=async b=>{const $={name:b.name+" (copie)",description:b.description,content:b.content,status:b.status,sequenceId:u.sequenceId};await n.saveScene($,u.sequenceId,b.id)},i=b=>{a.value=!1,we(()=>{l.value={...b},a.value=!0})};return(b,$)=>(o(),r("div",null,[a.value?(o(),A(fe,{key:0,scene:l.value,projectId:C.projectId,sequenceId:C.sequenceId,availableScenes:c(p),onClose:$[0]||($[0]=m=>a.value=!1),onSave:v,onDelete:j,onNavigate:i},null,8,["scene","projectId","sequenceId","availableScenes"])):M("",!0),c(p)&&c(p).length>0?(o(),r("div",Rt,[(o(!0),r(N,null,V(c(p),(m,_)=>(o(),r("div",{key:m.id,class:"ml-4 mb-4 p-4 border border-gray-200 rounded-lg shadow-sm hover:shadow-md transition-shadow"},[e("div",Ft,[e("h3",{id:`scene-${m.id}`,class:"font-bold text-blue-600 hover:text-blue-800 cursor-pointer",onClick:w=>s(m)},D(m.name),9,Zt),e("div",Kt,[e("button",{class:"p-1 rounded text-gray-600 hover:text-gray-800 hover:bg-gray-50",onClick:w=>s(m),title:"Ã‰diter la scÃ¨ne"},[P(c(ve),{class:"h-4 w-4"})],8,Jt),e("button",{disabled:_===0,class:R(["p-1 rounded",_===0?"text-gray-300 cursor-not-allowed":"text-blue-500 hover:text-blue-700 hover:bg-blue-50"]),onClick:w=>x(m,"up"),title:"DÃ©placer vers le haut"},[P(c(ce),{class:"h-4 w-4"})],10,Gt),e("button",{disabled:_===c(p).length-1,class:R(["p-1 rounded",_===c(p).length-1?"text-gray-300 cursor-not-allowed":"text-blue-500 hover:text-blue-700 hover:bg-blue-50"]),onClick:w=>x(m,"down"),title:"DÃ©placer vers le bas"},[P(c(ue),{class:"h-4 w-4"})],10,Qt),e("button",{class:"p-1 rounded text-green-500 hover:text-green-700 hover:bg-green-50",onClick:w=>f(m),title:"Dupliquer la scÃ¨ne"},[P(c(Ne),{class:"h-4 w-4"})],8,Wt),e("button",{class:"p-1 rounded text-red-500 hover:text-red-700 hover:bg-red-50",onClick:w=>j(m),title:"Supprimer la scÃ¨ne"},[P(c(Ve),{class:"h-4 w-4"})],8,Xt)])]),e("div",{class:"mt-2 prose prose-sm max-w-none scene-content printable-content p-4",innerHTML:m.content},null,8,Yt)]))),128)),e("div",en,[e("button",{onClick:$[1]||($[1]=m=>s()),class:"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[P(c(oe),{class:"h-4 w-4 mr-1"}),$[3]||($[3]=Z(" Ajouter une scÃ¨ne "))])])])):(o(),r("div",tn,[$[5]||($[5]=e("p",{class:"p-4 text-gray-500 italic"},"Aucune scÃ¨ne dans cette sÃ©quence",-1)),e("button",{onClick:$[2]||($[2]=m=>s()),class:"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[P(c(oe),{class:"h-4 w-4 mr-1"}),$[4]||($[4]=Z(" Ajouter une scÃ¨ne "))])]))]))}}),on={class:"bg-white"},sn={class:"flex items-center justify-between mb-2"},rn=["id"],ln={class:"flex items-center space-x-2"},an={class:"flex items-center space-x-1"},dn=["onClick"],un=["disabled","onClick"],cn=["disabled","onClick"],vn={class:"flex items-center space-x-2"},pn={class:"flex items-center space-x-1 text-xs text-gray-500"},mn={class:"flex items-center space-x-1 text-xs text-gray-500"},fn={class:"flex items-center space-x-1 text-xs text-gray-500"},gn={class:"flex"},xn={class:"text-justify w-3/4 mr-3"},bn={class:"bg-secondary flex justify-between"},hn=["onClick"],yn=["onClick"],wn={key:0,class:"mr-1"},_n={key:1},kn={class:"flex items-center space-x-1"},$n=["onClick"],Cn=["innerHTML"],Sn=O({__name:"SequenceList",props:{sequences:Array,projectId:Number,partId:Number},setup(C){const n=K(),u=Se(),p=W(),a=C,l=z(()=>a.sequences?[...a.sequences].sort((S,k)=>S.position-k.position):[]),t=q(!1),s=q(null),v=q(!1),j=q(null),x=q(!1),f=(S=null)=>{S?S={...S,part_id:a.partId}:S={name:"",description:"",part_id:a.partId},s.value=S,t.value=!0},i=async({sequence:S,afterSequenceId:k})=>{try{const d=await n.saveSequence(S,a.partId,k);if(t.value=!1,!S.id)await n.reloadPart(a.partId);else if(a.sequences){const g=a.sequences.findIndex(I=>I.id===d.id);g!==-1&&(a.sequences[g]=d)}}catch(d){console.error("Erreur lors de la sauvegarde :",d)}},b=async S=>{try{if(await n.deleteSequence(S.id),t.value=!1,a.sequences){const k=a.sequences.findIndex(d=>d.id===S.id);k!==-1&&a.sequences.splice(k,1)}}catch(k){console.error("Erreur lors de la suppression :",k)}},$=async(S,k)=>{var g;const d=l.value.findIndex(I=>I.id===S.id);try{if(k==="up"&&d>0){const I=[...l.value];[I[d],I[d-1]]=[I[d-1],I[d]],I.forEach((E,H)=>{E.position=H+1}),await n.saveSequenceOrder(I)}else if(k==="down"&&d<l.value.length-1){const I=[...l.value];[I[d],I[d+1]]=[I[d+1],I[d]],I.forEach((E,H)=>{E.position=H+1}),await n.saveSequenceOrder(I)}(g=n.project)!=null&&g.slug&&await n.fetchProject(n.project.slug)}catch(I){console.error("Erreur lors du dÃ©placement de la sÃ©quence:",I)}};async function m(S,k,d){try{const g=a.sequences.find(E=>E.id===d);if(!g)return;g[S]=k;const I={[S]:k};await n.updateSequenceMetadata(d,I)}catch(g){console.error(`Erreur lors de la mise Ã  jour du champ ${S}:`,g)}}const _=(S=null,k=null)=>{S||(S={firstName:"",lastName:"",age:0,background:""}),j.value={...S,sequenceId:k},v.value=!0},w=async S=>{var k;try{if(!((k=n.project)!=null&&k.id)){console.error("Aucun projet chargÃ©");return}const d=await p.savePersonnage(S,n.project.id);d&&(console.log("Personnage sauvegardÃ© :",d),n.project&&await n.fetchProject(n.project.slug))}catch(d){console.error("Erreur lors de la sauvegarde du personnage :",d)}v.value=!1},U=S=>p.getPersonnageName(S),G=async(S,k)=>{var d,g,I;try{const E=(d=a.sequences)==null?void 0:d.find(Q=>Q.id===k),H=(g=E==null?void 0:E.sequencePersonnages)==null?void 0:g.find(Q=>Q.id===S);H&&H.personnage&&(await p.removePersonnageFromSequence(k,H.personnage.id),(I=n.project)!=null&&I.slug&&await n.fetchProject(n.project.slug))}catch(E){console.error("Erreur lors de la suppression du personnage de la sÃ©quence :",E)}},Y=(S,k)=>{var g;const d=(g=S.sequenceCriterias)==null?void 0:g.find(I=>{var E;return((E=I.criteria)==null?void 0:E.id)===k});return(d==null?void 0:d.rating)||0},ee=()=>{};return(S,k)=>(o(),r("ul",on,[c(t)?(o(),A(pe,{key:0,sequence:c(s),projectId:C.projectId,onClose:k[0]||(k[0]=d=>t.value=!1),onSave:i,onDelete:b},null,8,["sequence","projectId"])):M("",!0),c(v)?(o(),A(Ce,{key:1,personnage:c(j),onClose:k[1]||(k[1]=d=>v.value=!1),onSave:w},null,8,["personnage"])):M("",!0),P(me),P(ft,{showConfig:c(x),"onUpdate:showConfig":k[2]||(k[2]=d=>_e(x)?x.value=d:null)},null,8,["showConfig"]),(o(!0),r(N,null,V(c(l),d=>(o(),r("li",{key:d.id,class:"pl-6 pr-3 pt-6 pb-6"},[e("div",sn,[e("h3",{id:`sequence-${d.id}`,class:"font-bold text-black text-xl"},D(d.name),9,rn),e("div",ln,[e("div",an,[e("button",{class:"p-1 rounded text-gray-600 hover:text-gray-800 hover:bg-gray-50",onClick:g=>f(d),title:"Ã‰diter la sÃ©quence"},[P(c(ve),{class:"h-4 w-4"})],8,dn),e("button",{disabled:c(l).findIndex(g=>g.id===d.id)===0,class:R(["p-1 rounded",c(l).findIndex(g=>g.id===d.id)===0?"text-gray-300 cursor-not-allowed":"text-blue-500 hover:text-blue-700 hover:bg-blue-50"]),onClick:g=>$(d,"up"),title:"DÃ©placer vers le haut"},[P(c(ce),{class:"h-4 w-4"})],10,un),e("button",{disabled:c(l).findIndex(g=>g.id===d.id)===c(l).length-1,class:R(["p-1 rounded",c(l).findIndex(g=>g.id===d.id)===c(l).length-1?"text-gray-300 cursor-not-allowed":"text-blue-500 hover:text-blue-700 hover:bg-blue-50"]),onClick:g=>$(d,"down"),title:"DÃ©placer vers le bas"},[P(c(ue),{class:"h-4 w-4"})],10,cn)]),e("div",vn,[e("div",pn,[k[4]||(k[4]=e("span",null,"Intention",-1)),P(te,{icon:c(je),text:d.intention??"",color:"text-amber-500",title:"Intention",placeholder:"Indiquez les Ã©motions et sensations que doit ressentir votre public durant cette sÃ©quence...",onSave:g=>m("intention",g,d.id)},null,8,["icon","text","onSave"])]),e("div",mn,[k[5]||(k[5]=e("span",null,"EsthÃ©tique",-1)),P(te,{icon:c(Ie),text:d.aesthetic_idea??"",color:"text-purple-500",title:"IdÃ©e esthÃ©tique",placeholder:"DÃ©crivez l'approche artistique et visuelle que vous souhaitez mettre en Å“uvre pour cette sÃ©quence...",onSave:g=>m("aesthetic_idea",g,d.id)},null,8,["icon","text","onSave"])]),e("div",fn,[k[6]||(k[6]=e("span",null,"Info",-1)),P(te,{icon:c(ze),text:d.information??"",color:"text-blue-500",title:"Information",placeholder:"PrÃ©cisez les informations narratives essentielles qui justifient cette sÃ©quence...",onSave:g=>m("information",g,d.id)},null,8,["icon","text","onSave"])])])])]),e("div",gn,[e("div",xn,[e("div",bn,[e("i",null,[k[7]||(k[7]=Z("Personnages : ")),d.sequencePersonnages&&d.sequencePersonnages.length?(o(!0),r(N,{key:0},V(d.sequencePersonnages,(g,I)=>(o(),r("span",{key:g.id,class:"inline-flex items-center mr-1"},[e("span",{class:"text-blue-600 hover:underline cursor-pointer mr-1",onClick:E=>_(g.personnage,d.id)},D(U(g.personnage)),9,hn),e("button",{onClick:E=>G(g.id,d.id),class:"text-red-500 hover:text-red-700 text-xs ml-1 cursor-pointer",title:"Retirer de cette sÃ©quence"}," Ã— ",8,yn),I<d.sequencePersonnages.length-1?(o(),r("span",wn,", ")):M("",!0)]))),128)):(o(),r("span",_n,"Aucun personnage"))]),e("div",kn,[e("div",{class:"font-bold cursor-pointer",onClick:g=>_(null,d.id)},"+",8,$n),e("button",{onClick:k[3]||(k[3]=g=>x.value=!0),class:"text-xs text-gray-500 hover:text-gray-700 cursor-pointer",title:"Configurer la dÃ©tection automatique"}," âš™ï¸ ")])]),e("div",{innerHTML:d.description,class:"text-gray-500 organizational-text"},null,8,Cn),P(nn,{scenes:d.scenes,projectId:C.projectId,sequenceId:d.id},null,8,["scenes","projectId","sequenceId"])]),e("div",null,[(o(!0),r(N,null,V(c(u).criterias,g=>(o(),r("div",{key:g.id},[Z(D(g.name)+" ",1),P(He,{rating:Y(d,g.id),sequenceId:d.id,criteriaId:g.id,onRate:ee},null,8,["rating","sequenceId","criteriaId"])]))),128))])])]))),128))]))}}),jn=X(Sn,[["__scopeId","data-v-42b1e07e"]]),In={class:"fixed inset-0 flex items-center justify-center z-50"},qn={class:"bg-white rounded p-6 w-[500px] border-2 border-amber-950 shadow-xl"},Pn={class:"text-xl font-bold mb-4"},Mn=["value"],Dn={class:"flex justify-between gap-2 mt-4"},En={key:0,class:"mt-4 p-4 border border-red-500 rounded bg-red-50"},Ln={class:"flex justify-end gap-2"},ge=O({__name:"PartModal",props:{part:{type:Object,default:null},projectId:{type:Number,required:!0}},emits:["close"],setup(C,{emit:n}){const u=K(),p=q(!1),a=C,l=n,t=q({name:"",description:""}),s=q(null),v=z(()=>u.parts);F(()=>a.part,f=>{if(t.value=f?{...f}:{name:"",description:""},f!=null&&f.id){const i=u.parts.findIndex(b=>b.id===f.id);i>0?s.value=u.parts[i-1].id:s.value=null}else s.value=null},{immediate:!0});const j=async()=>{if(!t.value.name.trim()){alert("Le nom est obligatoire.");return}try{t.value.project_id=a.projectId,await u.addPart(t.value,s.value),l("close")}catch(f){console.error("Erreur API :",f),alert("Erreur lors de la sauvegarde.")}},x=async()=>{if(t.value.id)try{await u.deletePart(t.value.id),l("close")}catch(f){console.error("Erreur API :",f),alert("Erreur lors de la suppression.")}};return(f,i)=>(o(),r("div",In,[e("div",qn,[e("h3",Pn,D(t.value.id?"Modifier la partie":"Ajouter une partie"),1),i[8]||(i[8]=e("label",{class:"block mb-2 font-semibold"},"Nom :",-1)),B(e("input",{type:"text","onUpdate:modelValue":i[0]||(i[0]=b=>t.value.name=b),class:"border rounded p-2 w-full mb-4"},null,512),[[J,t.value.name]]),i[9]||(i[9]=e("label",{class:"block mb-2 font-semibold"},"Description :",-1)),B(e("textarea",{"onUpdate:modelValue":i[1]||(i[1]=b=>t.value.description=b),class:"w-full border p-2 rounded h-24"},null,512),[[J,t.value.description]]),i[10]||(i[10]=e("label",{class:"block mt-4 font-semibold"},"Emplacement aprÃ¨s :",-1)),B(e("select",{"onUpdate:modelValue":i[2]||(i[2]=b=>s.value=b),class:"border rounded p-2 w-full"},[i[6]||(i[6]=e("option",{value:null},"DÃ©but du projet",-1)),(o(!0),r(N,null,V(v.value,b=>(o(),r("option",{key:b.id,value:b.id},D(b.name),9,Mn))),128))],512),[[ne,s.value]]),e("div",Dn,[t.value.id?(o(),r("button",{key:0,onClick:i[3]||(i[3]=b=>p.value=!0),class:"px-4 py-2 rounded bg-red-500 text-white"}," Supprimer ")):M("",!0),e("div",null,[e("button",{onClick:i[4]||(i[4]=b=>l("close")),class:"px-4 py-2 rounded bg-gray-400 text-white mr-2"}," Annuler "),e("button",{onClick:j,class:"px-4 py-2 rounded bg-blue-500 text-white"}," Enregistrer ")])]),p.value?(o(),r("div",En,[i[7]||(i[7]=e("p",{class:"text-red-700 mb-2"},"Confirmer la suppression de cette partie ?",-1)),e("div",Ln,[e("button",{onClick:i[5]||(i[5]=b=>p.value=!1),class:"px-3 py-1 rounded bg-gray-400 text-white"}," Annuler "),e("button",{onClick:x,class:"px-3 py-1 rounded bg-red-600 text-white"}," Oui, supprimer ")])])):M("",!0)])]))}}),An={class:"fixed bottom-4 right-4 flex flex-col gap-3 z-50"},Tn={key:0,class:"absolute bottom-16 right-0 bg-white rounded-lg shadow-xl p-2 w-48"},Nn={class:"border-b pb-2 mb-2"},Vn=O({__name:"ActionButtons",props:{projectId:{}},setup(C){const n=K(),u=q(null),p=q(!1),a=q(!1),l=()=>{n.collapseAllParts()},t=()=>{n.expandAllParts()},s=x=>{u.value=x,p.value=!0,a.value=!1},v=()=>{p.value=!1,u.value=null},j=async({sequence:x,afterSequenceId:f})=>{try{await n.saveSequence(x,x.part_id,f),v()}catch(i){console.error("Erreur lors de la sauvegarde :",i)}};return(x,f)=>(o(),r("div",null,[e("div",An,[e("button",{onClick:f[0]||(f[0]=i=>a.value=!c(a)),class:"bg-amber-600 hover:bg-amber-700 text-white font-bold p-3 rounded-full shadow-lg"},[P(c(oe),{class:"w-6 h-6"})]),c(a)?(o(),r("div",Tn,[e("div",Nn,[f[6]||(f[6]=e("h3",{class:"text-xs font-semibold text-gray-500 px-2 mb-1"},"Navigation",-1)),e("button",{onClick:l,class:"w-full text-left px-2 py-1 text-sm hover:bg-gray-100 rounded flex items-center gap-2"},[P(c(Le),{class:"w-4 h-4"}),f[4]||(f[4]=Z(" RÃ©duire tout "))]),e("button",{onClick:t,class:"w-full text-left px-2 py-1 text-sm hover:bg-gray-100 rounded flex items-center gap-2"},[P(c(Ee),{class:"w-4 h-4"}),f[5]||(f[5]=Z(" DÃ©velopper tout "))])]),e("div",null,[f[7]||(f[7]=e("h3",{class:"text-xs font-semibold text-gray-500 px-2 mb-1"},"CrÃ©ation",-1)),e("button",{onClick:f[1]||(f[1]=i=>s("part")),class:"w-full text-left px-2 py-1 text-sm hover:bg-gray-100 rounded"}," + Partie "),e("button",{onClick:f[2]||(f[2]=i=>s("sequence")),class:"w-full text-left px-2 py-1 text-sm hover:bg-gray-100 rounded"}," + SÃ©quence "),e("button",{onClick:f[3]||(f[3]=i=>s("scene")),class:"w-full text-left px-2 py-1 text-sm hover:bg-gray-100 rounded"}," + ScÃ¨ne ")])])):M("",!0)]),c(p)&&c(u)==="part"?(o(),A(ge,{key:0,projectId:x.projectId,onClose:v},null,8,["projectId"])):M("",!0),c(p)&&c(u)==="sequence"?(o(),A(pe,{key:1,projectId:x.projectId,onClose:v,onSave:j},null,8,["projectId"])):M("",!0),c(p)&&c(u)==="scene"?(o(),A(fe,{key:2,projectId:x.projectId,onClose:v},null,8,["projectId"])):M("",!0)]))}}),zn={style:{width:"100%"}},Bn={class:"mt-6 space-y-4"},On={class:"flex items-start gap-2"},Un=["onClick"],Hn={class:"flex-1"},Rn=["id","onClick"],Fn=["innerHTML","onClick"],Zn={key:0,class:"mt-4"},Kn=O({__name:"PartList",setup(C){const n=K(),u=q(!1),p=q(null),a=(s=null)=>{p.value=s,u.value=!0},l=s=>{n.togglePart(s)},t=s=>n.expandedParts.has(s);return(s,v)=>{var j,x,f;return o(),r("div",zn,[e("ul",Bn,[(o(!0),r(N,null,V((j=c(n).project)==null?void 0:j.parts,(i,b)=>{var $;return o(),r("li",{key:i.id,class:"bg-orange-50 rounded-lg p-4 hover:bg-orange-100 transition-colors"},[e("div",On,[e("button",{onClick:m=>l(i.id),class:"text-gray-500 hover:text-gray-700 mt-2 cursor-pointer transition-colors"},[t(i.id)?(o(),A(c(Ae),{key:0,class:"w-5 h-5"})):(o(),A(c(Te),{key:1,class:"w-5 h-5"}))],8,Un),e("div",Hn,[e("h2",{id:`part-${i.id}`,class:"font-bold text-2xl cursor-pointer hover:text-blue-600 transition-colors text-color-primary",onClick:m=>a(i)},D(c(Pe)(b+1))+". "+D(i.name),9,Rn),e("div",{innerHTML:i.description||"",class:"cursor-pointer hover:text-blue-600 transition-colors text-gray-500 organizational-text",onClick:m=>a(i)},null,8,Fn),t(i.id)?(o(),r("div",Zn,[P(jn,{sequences:i.sequences,projectId:(($=c(n).project)==null?void 0:$.id)||0,partId:i.id},null,8,["sequences","projectId","partId"])])):M("",!0)])])])}),128))]),P(Vn,{projectId:((x=c(n).project)==null?void 0:x.id)||0},null,8,["projectId"]),c(u)?(o(),A(ge,{key:0,part:c(p),projectId:((f=c(n).project)==null?void 0:f.id)||0,onClose:v[0]||(v[0]=i=>u.value=!1)},null,8,["part","projectId"])):M("",!0)])}}}),Jn=X(Kn,[["__scopeId","data-v-ab2a312a"]]),Gn={key:0},Qn={key:1},Wn={class:"relative"},Xn={class:"p-6 overflow-y-auto h-full pb-20"},Yn={class:"mb-4"},eo=["onClick"],to={key:0,class:"ml-4 mt-2"},no=["onClick"],oo={key:0,class:"ml-4 mt-1"},so=["onClick"],ro={class:"flex flex-col items-center p-6"},lo={class:"w-full max-w-4xl mb-6"},ao={class:"flex items-center gap-3 mb-2"},io={id:"project-title",class:"font-extrabold text-3xl"},uo=["innerHTML"],co=O({__name:"projet-[slug]",setup(C){ke().requireAuth();const u=K(),a=$e().params.slug;ie(()=>u.fetchProject(a));const l=z(()=>u.project),t=z(()=>u.parts),s=q(!1),v=j=>{const x=document.getElementById(j);x&&(x.scrollIntoView({behavior:"smooth",block:"start"}),s.value=!1)};return(j,x)=>l.value?(o(),r("div",Qn,[P(qe,{"project-slug":c(a)},null,8,["project-slug"]),e("div",Wn,[e("button",{onClick:x[0]||(x[0]=f=>s.value=!s.value),class:"fixed left-4 top-1/2 transform -translate-y-1/2 z-50 bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-full shadow-lg transition-all duration-300 hover:scale-110",title:"Table des matiÃ¨res"},[s.value?(o(),A(c(De),{key:1,class:"w-5 h-5"})):(o(),A(c(Me),{key:0,class:"w-5 h-5"}))]),e("div",{class:R(["fixed left-0 top-0 h-full w-80 bg-white shadow-xl transform transition-transform duration-300 ease-in-out z-40",s.value?"translate-x-0":"-translate-x-full"])},[x[2]||(x[2]=e("div",{class:"p-6 border-b border-gray-200"},[e("h3",{class:"text-lg font-bold text-gray-800 flex items-center gap-2"}," ðŸ“‹ Plan du projet ")],-1)),e("div",Xn,[e("div",Yn,[e("button",{onClick:x[1]||(x[1]=f=>v("project-title")),class:"w-full text-left p-2 rounded hover:bg-blue-50 text-blue-700 font-bold text-lg"},D(l.value.name),1)]),(o(!0),r(N,null,V(t.value,f=>(o(),r("div",{key:f.id,class:"mb-4"},[e("button",{onClick:i=>v(`part-${f.id}`),class:"w-full text-left p-2 rounded hover:bg-blue-50 text-blue-600 font-semibold flex items-center gap-2"}," ðŸ“– "+D(f.name),9,eo),f.sequences?(o(),r("div",to,[(o(!0),r(N,null,V(f.sequences,i=>(o(),r("div",{key:i.id,class:"mb-2"},[e("button",{onClick:b=>v(`sequence-${i.id}`),class:"w-full text-left p-2 rounded hover:bg-amber-50 text-amber-700 font-medium flex items-center gap-2"}," ðŸŽ¯ "+D(i.name),9,no),i.scenes?(o(),r("div",oo,[(o(!0),r(N,null,V(i.scenes,b=>(o(),r("button",{key:b.id,onClick:$=>v(`scene-${b.id}`),class:"w-full text-left p-1 px-2 rounded hover:bg-gray-50 text-gray-600 text-sm flex items-center gap-2"}," ðŸŽª "+D(b.name),9,so))),128))])):M("",!0)]))),128))])):M("",!0)]))),128))])],2),e("div",ro,[e("div",lo,[e("div",ao,[e("h1",io,D(l.value.name),1)]),l.value.description?(o(),r("p",{key:0,innerHTML:l.value.description,class:"italic text-justify"},null,8,uo)):M("",!0)]),P(Jn,{parts:t.value,projectId:l.value.id},null,8,["parts","projectId"])])])])):(o(),r("div",Gn,"Chargement..."))}}),$o=X(co,[["__scopeId","data-v-f52605ac"]]);export{$o as default};
