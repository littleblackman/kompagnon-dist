import{a2 as p,z as d,u as P}from"./Cnx3c5PK.js";const j=p("analytics",{state:()=>({projects:[],isLoading:!1,lastUpdated:null}),getters:{statistics:t=>{if(!t.projects||t.projects.length===0)return{totalProjects:0,totalParts:0,totalSequences:0,totalScenes:0,totalPersonnages:0,averagePartsPerProject:0,averageSequencesPerPart:0,averageScenesPerSequence:0,recentScenes:[]};let e=0,a=0,n=0,s=0;const r=[];t.projects.forEach(i=>{i.personnages&&(s+=i.personnages.length),i.parts&&(e+=i.parts.length,i.parts.forEach(h=>{h.sequences&&(a+=h.sequences.length,h.sequences.forEach(u=>{u.scenes&&(n+=u.scenes.length,u.scenes.forEach(f=>{r.push({...f,projectName:i.name,sequenceName:u.name})}))}))}))}),r.sort((i,h)=>h.id-i.id);const c=t.projects.length,o=c>0?e/c:0,l=e>0?a/e:0,g=a>0?n/a:0;return{totalProjects:c,totalParts:e,totalSequences:a,totalScenes:n,totalPersonnages:s,averagePartsPerProject:Math.round(o*10)/10,averageSequencesPerPart:Math.round(l*10)/10,averageScenesPerSequence:Math.round(g*10)/10,recentScenes:r.slice(0,10)}},projectStatistics:t=>t.projects.map(e=>{var c;let a=0,n=0,s=0,r=((c=e.personnages)==null?void 0:c.length)||0;return e.parts&&(a=e.parts.length,e.parts.forEach(o=>{o.sequences&&(n+=o.sequences.length,o.sequences.forEach(l=>{l.scenes&&(s+=l.scenes.length)}))})),{id:e.id,name:e.name,slug:e.slug,parts:a,sequences:n,scenes:s,personnages:r}})},actions:{async loadProjectsData(){this.isLoading=!0;try{const t=d(),e=P(),a=await $fetch(`${t.public.apiBase}/projects`,{headers:{Authorization:`Bearer ${e.token}`}}),n=await Promise.all(a.map(async s=>{try{return await $fetch(`${t.public.apiBase}/project/${s.slug}`,{headers:{Authorization:`Bearer ${e.token}`}})}catch(r){return console.error(`Erreur chargement projet ${s.slug}:`,r),{...s,parts:[]}}}));this.projects=n,this.lastUpdated=new Date}catch(t){throw console.error("Erreur chargement projets pour analytics:",t),t}finally{this.isLoading=!1}},async refreshIfNeeded(){const t=new Date(Date.now()-3e5);(!this.lastUpdated||this.lastUpdated<t||this.projects.length===0)&&await this.loadProjectsData()},async forceRefresh(){await this.loadProjectsData()},getProjectStats(t){var c;const e=this.projects.find(o=>o.id===t);if(!e)return null;let a=0,n=0,s=0;const r=((c=e.personnages)==null?void 0:c.length)||0;return e.parts&&(a=e.parts.length,e.parts.forEach(o=>{o.sequences&&(n+=o.sequences.length,o.sequences.forEach(l=>{l.scenes&&(s+=l.scenes.length)}))})),{projectName:e.name,parts:a,sequences:n,scenes:s,personnages:r}},getRecentScenesByProject(t,e=5){const a=this.projects.find(s=>s.id===t);if(!a||!a.parts)return[];const n=[];return a.parts.forEach(s=>{s.sequences&&s.sequences.forEach(r=>{r.scenes&&r.scenes.forEach(c=>{n.push({...c,projectName:a.name,sequenceName:r.name})})})}),n.sort((s,r)=>r.id-s.id),n.slice(0,e)}}});export{j as u};
