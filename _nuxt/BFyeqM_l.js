import{_ as te}from"./DKoE4HND.js";import{c as u,o,a as e,a2 as se,z as T,u as V,e as ae,r as P,f as F,A as re,i as B,b as c,h as t,y as k,t as _,m as Z,v as D,d as O,C as j,g as oe,w,a1 as C,j as le,F as ie,k as ne,a5 as de}from"./DDbqB2VL.js";import{u as ce}from"./DiHSmRhv.js";import{r as q}from"./BeOHE0yY.js";import{r as K}from"./BG1EWFq0.js";import{r as ue}from"./BqMwdbGL.js";import{u as pe}from"./DtC8KiHr.js";import{r as fe}from"./BcP2C12F.js";import{r as R}from"./CXHWB6y5.js";function ve(l,i){return o(),u("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"fill-rule":"evenodd",d:"M19.916 4.626a.75.75 0 0 1 .208 1.04l-9 13.5a.75.75 0 0 1-1.154.114l-6-6a.75.75 0 0 1 1.06-1.06l5.353 5.353 8.493-12.74a.75.75 0 0 1 1.04-.207Z","clip-rule":"evenodd"})])}function X(l,i){return o(),u("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{d:"M19.5 21a3 3 0 0 0 3-3v-4.5a3 3 0 0 0-3-3h-15a3 3 0 0 0-3 3V18a3 3 0 0 0 3 3h15ZM1.5 10.146V6a3 3 0 0 1 3-3h5.379a2.25 2.25 0 0 1 1.59.659l2.122 2.121c.14.141.331.22.53.22H19.5a3 3 0 0 1 3 3v1.146A4.483 4.483 0 0 0 19.5 9h-15a4.483 4.483 0 0 0-3 1.146Z"})])}function W(l,i){return o(),u("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{d:"M11.47 3.841a.75.75 0 0 1 1.06 0l8.69 8.69a.75.75 0 1 0 1.06-1.061l-8.689-8.69a2.25 2.25 0 0 0-3.182 0l-8.69 8.69a.75.75 0 1 0 1.061 1.06l8.69-8.689Z"}),e("path",{d:"m12 5.432 8.159 8.159c.03.03.06.058.091.086v6.198c0 1.035-.84 1.875-1.875 1.875H15a.75.75 0 0 1-.75-.75v-4.5a.75.75 0 0 0-.75-.75h-3a.75.75 0 0 0-.75.75V21a.75.75 0 0 1-.75.75H5.625a1.875 1.875 0 0 1-1.875-1.875v-6.198a2.29 2.29 0 0 0 .091-.086L12 5.432Z"})])}function Y(l,i){return o(),u("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"fill-rule":"evenodd",d:"M12 2.25a.75.75 0 0 1 .75.75v9a.75.75 0 0 1-1.5 0V3a.75.75 0 0 1 .75-.75ZM6.166 5.106a.75.75 0 0 1 0 1.06 8.25 8.25 0 1 0 11.668 0 .75.75 0 1 1 1.06-1.06c3.808 3.807 3.808 9.98 0 13.788-3.807 3.808-9.98 3.808-13.788 0-3.808-3.807-3.808-9.98 0-13.788a.75.75 0 0 1 1.06 0Z","clip-rule":"evenodd"})])}const G=se("user",{state:()=>({profile:null,isLoading:!1}),getters:{displayName:l=>l.profile?l.profile.fullName||l.profile.email:"",hasAvatar:l=>{var i;return!!((i=l.profile)!=null&&i.avatar)}},actions:{async fetchProfile(){this.isLoading=!0;try{const l=T(),i=V(),b=await $fetch(`${l.public.apiBase}/user/profile`,{headers:{"X-AUTH-TOKEN":i.token}});return this.profile=b.user,this.profile}catch(l){throw console.error("Erreur lors du chargement du profil:",l),l}finally{this.isLoading=!1}},async updateProfile(l){this.isLoading=!0;try{const i=T(),b=V(),n=await $fetch(`${i.public.apiBase}/user/profile`,{method:"POST",headers:{"Content-Type":"application/json","X-AUTH-TOKEN":b.token},body:l});return this.profile=n.user,n}catch(i){throw console.error("Erreur lors de la mise à jour du profil:",i),i}finally{this.isLoading=!1}},async updateFirstName(l){return this.updateProfile({firstName:l})},async updateLastName(l){return this.updateProfile({lastName:l})},async updateAvatar(l){return this.updateProfile({avatar:l})},async uploadAvatar(l){this.isLoading=!0;try{const i=T(),b=V(),n=new FormData;n.append("avatar",l);const s=await $fetch(`${i.public.apiBase}/user/upload-avatar`,{method:"POST",headers:{"X-AUTH-TOKEN":b.token},body:n});return this.profile=s.user,s}catch(i){throw console.error("Erreur lors de l'upload de l'avatar:",i),i}finally{this.isLoading=!1}},clearProfile(){this.profile=null}}}),me={key:0,class:"fixed inset-0 z-50 overflow-y-auto"},ge={class:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:p-0"},he={class:"relative bg-white rounded-lg shadow-xl transform transition-all sm:max-w-lg sm:w-full"},be={class:"px-6 py-4 border-b border-gray-200"},ye={class:"flex items-center justify-between"},xe={class:"px-6 py-4 space-y-4"},we={class:"text-center"},_e={class:"relative inline-block"},$e={class:"w-20 h-20 rounded-full overflow-hidden bg-gray-200 mx-auto"},ke=["src","alt"],Ne={key:1,class:"w-full h-full flex items-center justify-center"},je={class:"px-3 py-2 bg-gray-50 border border-gray-200 rounded-lg text-gray-600 cursor-pointer hover:bg-gray-100 transition-colors",title:"Cliquez pour modifier votre profil"},Ce={class:"p-3 bg-amber-50 border border-amber-200 rounded-lg"},Pe={class:"text-sm text-amber-800"},Se={class:"px-6 py-4 border-t border-gray-200 flex gap-3 justify-end"},Be=["disabled"],Me=["disabled"],Te={key:1,class:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"},Ae=ae({__name:"ProfileModal",props:{isOpen:{type:Boolean}},emits:["close"],setup(l,{emit:i}){const b=i,n=G(),s=P({firstName:"",lastName:"",avatar:""}),S=P(),y=P(!1),f=P(""),g=P(""),M=F(()=>s.value.avatar?s.value.avatar.startsWith("data:")||s.value.avatar.startsWith("http")?s.value.avatar:`${T().public.apiBase.replace("/api","")}/${s.value.avatar}`:null);re(()=>n.profile,a=>{a&&(s.value={firstName:a.firstName||"",lastName:a.lastName||"",avatar:a.avatar||""})},{immediate:!0});const h=()=>{b("close"),f.value="",g.value=""},p=()=>{s.value.avatar=""},r=()=>{var a;(a=S.value)==null||a.click()},v=(a,d=500)=>new Promise(N=>{const x=document.createElement("canvas"),m=x.getContext("2d"),$=new Image;$.onload=()=>{const E=Math.min($.width,$.height),J=($.width-E)/2,Q=($.height-E)/2;x.width=200,x.height=200,m==null||m.drawImage($,J,Q,E,E,0,0,200,200);const I=L=>{x.toBlob(z=>{if(z){const H=z.size/1024;if(console.log(`Compression avatar qualité ${L}: ${H.toFixed(0)}KB`),H<=d||L<=.1){const ee=new File([z],a.name,{type:a.type,lastModified:Date.now()});N(ee)}else I(L-.1)}},a.type,L)};I(.8)},$.src=URL.createObjectURL(a)}),A=async a=>{var x;const d=a.target,N=(x=d.files)==null?void 0:x[0];if(N){if(!N.type.startsWith("image/")){f.value="Veuillez sélectionner un fichier image",g.value="error";return}try{y.value=!0,f.value="Upload de l'avatar...",g.value="";const m=await v(N);console.log(`Image compressée: ${(m.size/1024).toFixed(0)}KB`);const $=await n.uploadAvatar(m);s.value.avatar=$.avatar,f.value="Avatar mis à jour avec succès !",g.value="success",setTimeout(()=>{f.value="",g.value=""},2e3)}catch(m){console.error("Erreur upload avatar:",m),f.value="Erreur lors de l'upload de l'avatar",g.value="error"}finally{y.value=!1,d.value=""}}},U=async()=>{y.value=!0,f.value="";try{await n.updateProfile(s.value),f.value="Profil mis à jour avec succès !",g.value="success",setTimeout(()=>{h()},1e3)}catch(a){console.error("Erreur lors de la sauvegarde:",a),f.value="Erreur lors de la mise à jour du profil",g.value="error"}finally{y.value=!1}};return(a,d)=>{var N,x;return a.isOpen?(o(),u("div",me,[e("div",ge,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:h}),e("div",he,[e("div",be,[e("div",ye,[d[2]||(d[2]=e("h3",{class:"text-lg font-medium text-gray-900"},"Mon Profil",-1)),e("button",{onClick:h,class:"text-gray-400 hover:text-gray-600 transition-colors"},[c(t(q),{class:"w-6 h-6"})])])]),e("div",xe,[f.value?(o(),u("div",{key:0,class:k(["p-3 rounded-lg text-sm",g.value==="success"?"bg-green-50 text-green-700 border border-green-200":"bg-red-50 text-red-700 border border-red-200"])},_(f.value),3)):B("",!0),e("div",we,[e("div",_e,[e("div",$e,[t(M)?(o(),u("img",{key:0,src:t(M),alt:t(n).displayName,class:"w-full h-full object-cover",onError:p},null,40,ke)):(o(),u("div",Ne,[c(t(K),{class:"w-10 h-10 text-gray-400"})]))]),e("button",{onClick:r,class:"absolute bottom-0 right-0 bg-amber-500 text-white p-2 rounded-full hover:bg-amber-600 transition-colors",title:"Changer l'avatar"},[c(t(ue),{class:"w-4 h-4"})])]),e("input",{ref_key:"fileInput",ref:S,type:"file",accept:"image/*",onChange:A,class:"hidden"},null,544)]),e("div",null,[d[3]||(d[3]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Email ",-1)),e("div",je,_((N=t(n).profile)==null?void 0:N.email),1),d[4]||(d[4]=e("p",{class:"mt-1 text-xs text-gray-500"},"L'email ne peut pas être modifié (clé d'identification)",-1))]),e("div",null,[d[5]||(d[5]=e("label",{for:"firstName",class:"block text-sm font-medium text-gray-700 mb-2"}," Prénom ",-1)),Z(e("input",{id:"firstName","onUpdate:modelValue":d[0]||(d[0]=m=>s.value.firstName=m),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500",placeholder:"Votre prénom"},null,512),[[D,s.value.firstName]])]),e("div",null,[d[6]||(d[6]=e("label",{for:"lastName",class:"block text-sm font-medium text-gray-700 mb-2"}," Nom ",-1)),Z(e("input",{id:"lastName","onUpdate:modelValue":d[1]||(d[1]=m=>s.value.lastName=m),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500",placeholder:"Votre nom"},null,512),[[D,s.value.lastName]])]),e("div",Ce,[e("p",Pe,[d[7]||(d[7]=e("strong",null,"Nom d'affichage :",-1)),O(" "+_(s.value.firstName||s.value.lastName?`${s.value.firstName} ${s.value.lastName}`.trim():(x=t(n).profile)==null?void 0:x.email),1)])])]),e("div",Se,[e("button",{onClick:h,disabled:y.value,class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50"}," Annuler ",8,Be),e("button",{onClick:U,disabled:y.value,class:"px-4 py-2 text-sm font-medium text-white bg-amber-600 rounded-lg hover:bg-amber-700 transition-colors disabled:opacity-50 flex items-center gap-2"},[y.value?(o(),u("div",Te)):(o(),j(t(ve),{key:0,class:"w-4 h-4"})),O(" "+_(y.value?"Sauvegarde...":"Sauvegarder"),1)],8,Me)])])])])):B("",!0)}}}),Ue={class:"flex h-screen overflow-hidden bg-light text-color"},Ee={class:"sidebar-collapsed"},Le=["title"],Ve={class:"sidebar-nav"},Ke={class:"sidebar-user"},ze=["title"],Fe=["src","alt"],Oe={key:0,class:"sidebar-expanded-content"},Ie={class:"p-4 space-y-2"},He={key:0,class:"px-4 pb-4"},Ze={class:"border-t border-gray-100 pt-4"},De={class:"space-y-1"},Re={class:"flex items-center justify-between"},Xe={class:"flex-1 min-w-0"},We={class:"text-sm font-medium text-gray-900 truncate"},Ye={class:"text-xs text-gray-500"},qe={class:"mt-auto p-4 border-t border-gray-100"},Ge={key:0,class:"flex items-center space-x-3"},Je=["src","alt"],Qe={class:"flex-1 min-w-0"},et={class:"text-sm font-medium text-gray-900 truncate"},tt={class:"flex-1 flex flex-col overflow-auto bg-light text-color"},st={class:"header bg-cta flex justify-between items-center"},at={class:"font-bold text-2xl text-left"},rt={key:0,class:"flex items-center space-x-3"},ot={class:"text-right"},lt={class:"text-sm font-medium text-gray-900"},it={class:"text-xs text-gray-600"},nt=["title"],dt=["src","alt"],ct={class:"flex-1"},xt={__name:"default",setup(l){pe({title:"Kompagnon App - Écrivez vos projets",meta:[{name:"description",content:"Application Kompagnon pour gérer efficacement vos projets d’écriture"},{charset:"utf-8"},{name:"viewport",content:"width=device-width, initial-scale=1"}],link:[{rel:"icon",type:"image/png",href:"/logo-kpgn.png"}]});const i=V(),b=ce(),n=G(),s=P(!1),S=P(!1),y=()=>{s.value=!s.value},f=()=>{S.value=!0,s.value=!1},g=()=>{S.value=!1};oe(async()=>{i.token&&(await b.refreshIfNeeded(),await n.fetchProfile())});const M=F(()=>b.projectStatistics.slice(0,3)),h=F(()=>{var v;return(v=n.profile)!=null&&v.avatar?`${T().public.apiBase.replace("/api","")}/${n.profile.avatar}`:null});return(p,r)=>{var A,U;const v=te;return o(),u("div",Ue,[e("aside",{class:k(["sidebar-container",{"sidebar-expanded":s.value}])},[e("div",Ee,[e("button",{onClick:y,class:"sidebar-toggle",title:s.value?"Fermer le menu":"Ouvrir le menu"},[s.value?(o(),j(t(q),{key:1,class:"w-5 h-5"})):(o(),j(t(fe),{key:0,class:"w-5 h-5"}))],8,Le),r[4]||(r[4]=e("div",{class:"sidebar-logo"},[e("div",{class:"w-10 h-10 bg-gradient-to-br from-amber-400 to-amber-600 rounded-lg flex items-center justify-center"},[e("span",{class:"text-white font-bold text-lg"},"K")])],-1)),e("nav",Ve,[c(v,{to:"/",class:k(["sidebar-icon",{"sidebar-icon-active":(p._.provides[C]||p.$route).path==="/"}]),title:"Tableau de bord"},{default:w(()=>[c(t(W),{class:"w-5 h-5"})]),_:1},8,["class"]),c(v,{to:"/projets/tous",class:k(["sidebar-icon",{"sidebar-icon-active":(p._.provides[C]||p.$route).path==="/projets/tous"}]),title:"Tous les projets"},{default:w(()=>[c(t(X),{class:"w-5 h-5"})]),_:1},8,["class"]),c(v,{to:"/projets/creer",class:k(["sidebar-icon",{"sidebar-icon-active":(p._.provides[C]||p.$route).path==="/projets/creer"}]),title:"Nouveau projet"},{default:w(()=>[c(t(R),{class:"w-5 h-5"})]),_:1},8,["class"])]),e("div",Ke,[t(i).user?(o(),u("button",{key:0,onClick:f,class:"w-8 h-8 rounded-full overflow-hidden bg-gray-300 flex items-center justify-center hover:bg-gray-400 transition-colors",title:t(n).displayName},[h.value?(o(),u("img",{key:0,src:h.value,alt:t(n).displayName,class:"w-full h-full object-cover"},null,8,Fe)):(o(),j(t(K),{key:1,class:"w-4 h-4 text-gray-600"}))],8,ze)):(o(),j(v,{key:1,to:"/login",class:"sidebar-icon",title:"Connexion"},{default:w(()=>[c(t(Y),{class:"w-5 h-5"})]),_:1}))])]),s.value?(o(),u("div",Oe,[r[10]||(r[10]=le('<div class="p-6 border-b border-gray-100"><div class="flex items-center space-x-3"><div class="w-10 h-10 bg-gradient-to-br from-amber-400 to-amber-600 rounded-lg flex items-center justify-center"><span class="text-white font-bold text-lg">K</span></div><div><h2 class="text-lg font-semibold text-gray-900">Kompagnon</h2><p class="text-sm text-gray-500">Assistant créatif</p></div></div></div>',1)),e("nav",Ie,[c(v,{to:"/",class:k(["nav-item",{"nav-item-active":(p._.provides[C]||p.$route).path==="/"}]),onClick:r[0]||(r[0]=a=>s.value=!1)},{default:w(()=>[c(t(W),{class:"w-5 h-5"}),r[5]||(r[5]=e("span",null,"Tableau de bord",-1))]),_:1},8,["class"]),c(v,{to:"/projets/tous",class:k(["nav-item",{"nav-item-active":(p._.provides[C]||p.$route).path==="/projets/tous"}]),onClick:r[1]||(r[1]=a=>s.value=!1)},{default:w(()=>[c(t(X),{class:"w-5 h-5"}),r[6]||(r[6]=e("span",null,"Tous les projets",-1))]),_:1},8,["class"]),c(v,{to:"/projets/creer",class:k(["nav-item",{"nav-item-active":(p._.provides[C]||p.$route).path==="/projets/creer"}]),onClick:r[2]||(r[2]=a=>s.value=!1)},{default:w(()=>[c(t(R),{class:"w-5 h-5"}),r[7]||(r[7]=e("span",null,"Nouveau projet",-1))]),_:1},8,["class"])]),t(i).token&&M.value.length>0?(o(),u("div",He,[e("div",Ze,[r[9]||(r[9]=e("h3",{class:"text-xs font-medium text-gray-500 uppercase tracking-wider mb-3"}," Projets récents ",-1)),e("div",De,[(o(!0),u(ie,null,ne(M.value,a=>(o(),j(v,{key:a.id,to:`/projets/projet-${a.slug}`,class:k(["project-item",{"project-item-active":(p._.provides[C]||p.$route).path.includes(`projet-${a.slug}`)}]),onClick:r[3]||(r[3]=d=>s.value=!1)},{default:w(()=>[e("div",Re,[e("div",Xe,[e("p",We,_(a.name),1),e("p",Ye,_(a.scenes)+" scènes ",1)]),r[8]||(r[8]=e("div",{class:"w-2 h-2 bg-green-400 rounded-full flex-shrink-0 ml-2"},null,-1))])]),_:2},1032,["to","class"]))),128))])])])):B("",!0),e("div",qe,[t(i).user?(o(),u("div",Ge,[e("button",{onClick:f,class:"w-8 h-8 rounded-full overflow-hidden bg-gray-300 flex items-center justify-center hover:bg-gray-400 transition-colors"},[h.value?(o(),u("img",{key:0,src:h.value,alt:t(n).displayName,class:"w-full h-full object-cover"},null,8,Je)):(o(),j(t(K),{key:1,class:"w-4 h-4 text-gray-600"}))]),e("div",Qe,[e("p",et,_(t(n).displayName),1),e("button",{onClick:f,class:"text-xs text-gray-500 truncate hover:text-amber-600 transition-colors cursor-pointer",title:"Cliquez pour modifier votre profil"},_((A=t(n).profile)==null?void 0:A.email),1)]),c(v,{to:"/logout",class:"text-gray-400 hover:text-gray-600"},{default:w(()=>[c(t(Y),{class:"w-4 h-4"})]),_:1})])):B("",!0)])])):B("",!0)],2),e("main",tt,[e("header",st,[e("h1",at,[c(v,{to:"/"},{default:w(()=>r[11]||(r[11]=[O("Kompagnon")])),_:1})]),t(i).user?(o(),u("div",rt,[e("div",ot,[e("p",lt,_(t(n).displayName),1),e("p",it,_((U=t(n).profile)==null?void 0:U.email),1)]),e("button",{onClick:f,class:"w-10 h-10 rounded-full overflow-hidden bg-gray-300 flex items-center justify-center hover:bg-gray-400 transition-colors",title:t(n).displayName},[h.value?(o(),u("img",{key:0,src:h.value,alt:t(n).displayName,class:"w-full h-full object-cover"},null,8,dt)):(o(),j(t(K),{key:1,class:"w-5 h-5 text-gray-600"}))],8,nt)])):B("",!0)]),e("div",ct,[de(p.$slots,"default")])]),c(Ae,{"is-open":S.value,onClose:g},null,8,["is-open"])])}}};export{xt as default};
